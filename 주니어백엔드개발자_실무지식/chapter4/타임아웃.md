# 타임아웃: 외부 연동에서 가장 중요한 설정
- Ex) A서비스(tomcat): thread pool(size=200) -> A서비스는 동시에 200개의 요청 처리 가능
  - A서비스는 B서비스를 호출, B서비스에 성능 문제가 생겨 응답 시간이 60초를 넘어감
- 상황: A서비스에 아무 요청이 없는 상태에서 100명이 동시에 요청을 보내서 처리함
  - 이 100개의 요청은 B서비스를 호출함
  - B서비스가 응답하지 못하고 있어 A서비스의 100개의 요청 스레드는 응답을 기다리며 모두 대기상태가 됨
  - 그 후, 다른 100명의 사용자가 동시에 A서비스로 요청을 보내어 A서비스는 200개의 요청을 처리중이고 B서비스의 응답을 기다리고 있는 상태
  - 그 후, 새로운 100명이 요청을 보내면, A서비스는 동시에 처리할 요청의 개수를 넘어서서 처리할 수 없게 됨
  - 그래서 무한 대기를 하게 되고 서비스는 마비됨
- 연동서비스에 **타임아웃**을 걸지 않으면 연동 서비스의 응답이 느릴 때, 처리량이 급격하게 떨어짐

- 2가지 타임아웃: **연결 타임아웃과 읽기 타임아웃**
  - API 통신 과정을 보면 연결, 요청, 응답, 종료 단계를 거침
    - 연결 시도 대기시간: 연결에 오래걸리면 `connection timeout`을 설정해 연결 대기 시간을 제한
    - 요청 전송후 응답까지 대기시간: `read timeout`을 설정해서 응답 대기시간을 제한
  - 소켓 타임아웃과 읽기 타임아웃
    - 읽기 타임아웃을 지정할 때, 실제로 설정하는 값이 무엇인지 확인해야 함
    - Apache HttpClient는 소켓 타임아웃을 설정함
    - 소켓 타임아웃은 네트워크 패킷 단위를 기준으로 하므로 전체 응답시간에 대한 타임아웃이 아님 -> 소켓 타임아웃을 5초로 지정해도 전체 응답시간은 5초이상 소요될 수 있음
    - OkHttp는 읽기 타임아웃과 별개로 호출 타임아웃을 설정할 수 있음
    - 호출 타임아웃은 요청 시작부터 응답까지의 전체 시간을 기준으로 설정됨
